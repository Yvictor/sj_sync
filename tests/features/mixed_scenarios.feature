# language: zh-TW
功能: 混合交易場景
  作為交易者
  我想要在各種複雜情況下正確追蹤庫存
  包括多次交易和不同條件的組合

  場景: 有昨日資買 - 當天資買再券賣當沖
    假設 我有昨日資買庫存 2330 數量 10 張
    當 我資買 2330 數量 5 張
    那麼 資買庫存應為 15 張，昨日庫存為 10 張，昨日已抵銷 0 張
    當 我券賣 2330 數量 5 張
    那麼 資買庫存應為 10 張，昨日庫存為 10 張，昨日已抵銷 0 張
    # 券賣抵銷當天的資買 5 張（當沖）
    # 昨日庫存不受影響

  場景: 有昨日資買 - 當天券賣超過當天資買數量
    假設 我有昨日資買庫存 2330 數量 10 張
    當 我資買 2330 數量 3 張
    那麼 資買庫存應為 13 張，昨日庫存為 10 張，昨日已抵銷 0 張
    當 我券賣 2330 數量 8 張
    那麼 資買庫存應為 10 張，昨日庫存為 10 張，昨日已抵銷 0 張
    而且 券賣庫存應為 5 張
    # 券賣先抵銷當天資買 3 張（當沖）
    # 剩餘 5 張券賣**不能**抵銷昨日資買（台灣規則：券賣只能用券買平倉）
    # 所以剩餘 5 張券賣會建立新的券賣庫存
    # 資買庫存：quantity=10（昨日的10張保持不變）, yd_quantity=10, yd_offset_quantity=0
    # 券賣庫存：quantity=5（新建立的券賣部位）

  場景: 連續當沖交易
    假設 我沒有任何庫存
    當 我現股買 2330 數量 10 張
    當 我現股賣 2330 數量 5 張
    那麼 現股庫存應為 5 張
    當 我現股買 2330 數量 3 張
    那麼 現股庫存應為 8 張
    當 我現股賣 2330 數量 8 張
    那麼 現股庫存應為 0 張

  場景: 分批建立資買庫存後資賣
    假設 我有昨日資買庫存 2330 數量 10 張
    當 我資買 2330 數量 5 張
    當 我資買 2330 數量 5 張
    那麼 資買庫存應為 20 張，昨日庫存為 10 張，昨日已抵銷 0 張
    當 我資賣 2330 數量 8 張
    那麼 資買庫存應為 12 張，昨日庫存為 10 張，昨日已抵銷 8 張
    # 資賣只能抵銷昨日庫存
    # yd_quantity=10(固定), quantity=12, yd_offset_quantity=8
    # 昨日實際剩餘 = 10-8 = 2 張
    # 今日實際剩餘 = 12-2 = 10 張
