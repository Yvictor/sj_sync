# language: zh-TW
功能: 盤中重啟計算昨日已抵銷數量
  作為交易者
  當程式在盤中重啟時
  系統應該能從今天的交易記錄正確計算 yd_offset_quantity
  以確保昨日庫存追蹤的準確性

  場景: 盤中重啟 - 昨日資買部分平倉後重啟
    假設 今天已有交易記錄：資賣 2330 數量 5 張
    當 系統初始化並從券商取得部位：資買 2330 數量 5 張，昨日庫存 10 張
    那麼 資買庫存應為 5 張，昨日庫存為 10 張，昨日已抵銷 5 張
    # 昨日資買 10 張
    # 今天資賣 5 張（已執行）
    # 重啟時應計算出 yd_offset = 5

  場景: 盤中重啟 - 昨日資買加碼後重啟
    假設 今天已有交易記錄：資買 2330 數量 5 張
    當 系統初始化並從券商取得部位：資買 2330 數量 15 張，昨日庫存 10 張
    那麼 資買庫存應為 15 張，昨日庫存為 10 張，昨日已抵銷 0 張
    # 昨日資買 10 張
    # 今天資買 5 張（加碼，不影響昨日）
    # yd_offset = 0

  場景: 盤中重啟 - 昨日資買先平倉再加碼後重啟
    假設 今天已有交易記錄：資賣 2330 數量 5 張，資買 2330 數量 3 張
    當 系統初始化並從券商取得部位：資買 2330 數量 8 張，昨日庫存 10 張
    那麼 資買庫存應為 8 張，昨日庫存為 10 張，昨日已抵銷 5 張
    # 昨日資買 10 張
    # 今天資賣 5 張（抵銷昨日）+ 資買 3 張（加碼）
    # yd_offset = 5

  場景: 盤中重啟 - 昨日券賣部分回補後重啟
    假設 今天已有交易記錄：券買 2330 數量 3 張
    當 系統初始化並從券商取得部位：券賣 2330 數量 7 張，昨日庫存 10 張
    那麼 券賣庫存應為 7 張，昨日庫存為 10 張，昨日已抵銷 3 張
    # 昨日券賣 10 張
    # 今天券買 3 張（回補昨日）
    # yd_offset = 3

  場景: 盤中重啟 - 跨條件當沖不影響昨日抵銷
    假設 今天已有交易記錄：資買 2330 數量 3 張，券賣 2330 數量 8 張
    當 系統初始化並從券商取得部位：資買 2330 數量 10 張，昨日庫存 10 張
    而且 券賣部位：券賣 2330 數量 5 張，昨日庫存 0 張
    那麼 資買庫存應為 10 張，昨日庫存為 10 張，昨日已抵銷 0 張
    而且 券賣庫存應為 5 張，昨日庫存為 0 張
    # 昨日資買 10 張
    # 今天資買 3 張 + 券賣 8 張（當沖抵銷 3 張，剩 5 張建券賣）
    # 資買 yd_offset = 0（當沖不影響昨日）
    # 券賣 yd_offset = 0（沒有昨日券賣）

  場景: 盤中重啟 - 昨日資買今天先加碼再平倉
    假設 今天已有交易記錄：資買 2330 數量 5 張，資賣 2330 數量 7 張
    當 系統初始化並從券商取得部位：資買 2330 數量 8 張，昨日庫存 10 張
    那麼 資買庫存應為 8 張，昨日庫存為 10 張，昨日已抵銷 7 張
    # 昨日資買 10 張
    # 今天資買 5 張 + 資賣 7 張
    # yd_offset = 7（同條件反向交易都算抵銷昨日）

  場景: 盤中重啟 - 現股昨日買進今天賣出
    假設 今天已有交易記錄：現股賣 2330 數量 3 張
    當 系統初始化並從券商取得部位：現股 2330 數量 7 張，昨日庫存 10 張
    那麼 現股庫存應為 7 張，昨日庫存為 10 張
    # 昨日現股買 10 張
    # 今天現股賣 3 張
    # yd_offset = 3

  場景: 盤中重啟 - 複雜情境：多次交易後重啟
    假設 今天已有交易記錄：資買 2330 數量 3 張，資賣 2330 數量 8 張，資買 2330 數量 2 張
    當 系統初始化並從券商取得部位：資買 2330 數量 7 張，昨日庫存 10 張
    那麼 資買庫存應為 7 張，昨日庫存為 10 張，昨日已抵銷 8 張
    # 昨日資買 10 張
    # 今天資買 3+2=5 張，資賣 8 張
    # yd_offset = 8（所有資賣都算抵銷昨日）

  場景: 盤中重啟 - 無今日交易
    假設 今天沒有交易記錄
    當 系統初始化並從券商取得部位：資買 2330 數量 10 張，昨日庫存 10 張
    那麼 資買庫存應為 10 張，昨日庫存為 10 張，昨日已抵銷 0 張
    # 今天沒交易，yd_offset = 0

  場景: 盤中重啟 - 今日新開倉無昨日庫存
    假設 今天已有交易記錄：資買 2330 數量 5 張
    當 系統初始化並從券商取得部位：資買 2330 數量 5 張，昨日庫存 0 張
    那麼 資買庫存應為 5 張，昨日庫存為 0 張，昨日已抵銷 0 張
    # 今天新開的資買，沒有昨日庫存
    # yd_offset = 0（因為 yd_quantity = 0）
